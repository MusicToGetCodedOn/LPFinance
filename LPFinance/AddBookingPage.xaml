<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="LPFinance.AddBookingPage"
             Title="Neue Buchung"
             BackgroundColor="{StaticResource LPBackground}">

    <ScrollView>
        <VerticalStackLayout Padding="30" Spacing="20" MaximumWidthRequest="600" HorizontalOptions="Center">

            <Label Text="Neue Buchung erfassen" FontSize="26" FontAttributes="Bold" TextColor="{StaticResource LPBlue}" />

            <VerticalStackLayout Spacing="2">
                <Label Text="Betrag (CHF)" TextColor="Black" FontAttributes="Bold" />
                <Border x:Name="AmountBorder" StrokeShape="RoundRectangle 8" Padding="10,0" BackgroundColor="White" Stroke="Transparent">
                    <Entry x:Name="AmountEntry" Placeholder="0.00" PlaceholderColor="Gray" TextColor="Black" Keyboard="Numeric" HeightRequest="45" TextChanged="OnAmountTextChanged" />
                </Border>
                <Label x:Name="AmountErrorLabel" Text="Betrag muss eine Zahl größer als 0 sein" TextColor="{StaticResource LPRed}" FontSize="12" IsVisible="False" Margin="5,0,0,0"/>
            </VerticalStackLayout>

            <VerticalStackLayout Spacing="2">
                <Label Text="Datum" TextColor="Black" FontAttributes="Bold" />
                <Border x:Name="DateBorder" StrokeShape="RoundRectangle 8" Padding="10,0" BackgroundColor="White" Stroke="Transparent">
                    <DatePicker x:Name="BookingDatePicker" 
                                Format="dd.MM.yyyy" 
                                TextColor="Black" 
                                HeightRequest="45" 
                                DateSelected="OnDateSelected" />
                </Border>
                <Label x:Name="DateErrorLabel" Text="Datum darf nicht in der Zukunft liegen" TextColor="{StaticResource LPRed}" FontSize="12" IsVisible="False" Margin="5,0,0,0"/>
            </VerticalStackLayout>

            <VerticalStackLayout Spacing="2">
                <Label Text="SOLL-Konto" TextColor="Black" FontAttributes="Bold" />
                <Border x:Name="SollBorder" StrokeShape="RoundRectangle 8" Padding="10,0" BackgroundColor="White" Stroke="Transparent">
                    <Picker x:Name="SollPicker" ItemDisplayBinding="{Binding Name}" HorizontalOptions="Fill" VerticalOptions="Center" TextColor="Black" HeightRequest="45" SelectedIndexChanged="OnSollSelectedIndexChanged" />
                </Border>
                <Label x:Name="SollErrorLabel" Text="Bitte wählen Sie ein Soll-Konto aus" TextColor="{StaticResource LPRed}" FontSize="12" IsVisible="False" Margin="5,0,0,0"/>
            </VerticalStackLayout>

            <VerticalStackLayout Spacing="2">
                <Label Text="HABEN-Konto" TextColor="Black" FontAttributes="Bold" />
                <Border x:Name="HabenBorder" StrokeShape="RoundRectangle 8" Padding="10,0" BackgroundColor="White" Stroke="Transparent">
                    <Picker x:Name="HabenPicker" ItemDisplayBinding="{Binding Name}" HorizontalOptions="Fill" VerticalOptions="Center" TextColor="Black" HeightRequest="45" SelectedIndexChanged="OnHabenSelectedIndexChanged" />
                </Border>
                <Label x:Name="HabenErrorLabel" Text="Bitte wählen Sie ein Haben-Konto aus" TextColor="{StaticResource LPRed}" FontSize="12" IsVisible="False" Margin="5,0,0,0"/>
            </VerticalStackLayout>

            <VerticalStackLayout Spacing="2">
                <Label Text="Beschreibung" TextColor="Black" FontAttributes="Bold" />
                <Border x:Name="DescBorder" StrokeShape="RoundRectangle 8" Padding="10,0" BackgroundColor="White" Stroke="Transparent">
                    <Entry x:Name="DescriptionEntry" Placeholder="z.B. Miete" TextColor="Black" PlaceholderColor="Gray" HeightRequest="45" TextChanged="OnDescriptionTextChanged" />
                </Border>
                <Label x:Name="DescErrorLabel" Text="Beschreibung darf nicht leer sein" TextColor="{StaticResource LPRed}" FontSize="12" IsVisible="False" Margin="5,0,0,0"/>
            </VerticalStackLayout>

            <HorizontalStackLayout Spacing="15" VerticalOptions="Center">
                <Label Text="Hohe Priorität / Dringend?" TextColor="Black" VerticalOptions="Center" />
                <Switch x:Name="UrgentSwitch" OnColor="{StaticResource LPOrange}" ThumbColor="{StaticResource LPBlue}" />
            </HorizontalStackLayout>

            <Button Text="Buchung speichern" Clicked="OnSaveBookingClicked" 
                    BackgroundColor="{StaticResource LPBlue}" TextColor="White" FontAttributes="Bold" CornerRadius="8" HeightRequest="50" />

            <Label Text="Journal" FontSize="20" FontAttributes="Bold" Margin="0,10,0,0" TextColor="Black" />
            <CollectionView x:Name="JournalList" HeightRequest="300">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Border StrokeShape="RoundRectangle 8" Margin="0,5" Padding="15" BackgroundColor="White">
                            <Grid ColumnDefinitions="*, Auto">
                                <VerticalStackLayout Grid.Column="0">
                                    <HorizontalStackLayout Spacing="10">
                                        <Label Text="{Binding DisplayDate}" FontSize="10" TextColor="Gray" />
                                        <Label Text="DRINGEND" FontSize="10" TextColor="{StaticResource LPRed}" FontAttributes="Bold" IsVisible="{Binding IsUrgent}" />
                                    </HorizontalStackLayout>
                                    <Label Text="{Binding DisplayAccounts}" FontAttributes="Bold" TextColor="Black" />
                                    <Label Text="{Binding Text}" FontSize="12" TextColor="Gray" />
                                </VerticalStackLayout>
                                <Label Grid.Column="1" Text="{Binding DisplayAmount}" VerticalOptions="Center" FontAttributes="Bold" TextColor="{StaticResource LPBlue}" />
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>